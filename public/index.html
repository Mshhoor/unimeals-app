<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>منصة وجبتي - تبادل الوجبات الجامعية</title>
  <link rel="stylesheet" href="style.css">
  
  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" onclick="toggleTheme()" title="تبديل الوضع">
    <span id="themeIcon">🌙</span>
  </button>

  <header>
    <h1>🍽️ منصة وجبتي</h1>
    <p>منصة آمنة ومتطورة لتبادل وجبات المطعم مع نظام التقييم والتحقق المتقدم</p>
  </header>

  <!-- Auth Section (Login/Register) -->
  <div class="container" id="authSection">
    <div class="auth-tabs">
      <button class="auth-tab-btn active" onclick="showAuthTab('signin')">تسجيل الدخول</button>
      <button class="auth-tab-btn" onclick="showAuthTab('signup')">إنشاء حساب</button>
    </div>

    <!-- Sign In Form -->
    <div id="signin-tab" class="auth-tab-content active">
      <div class="section-header">
        <h2>تسجيل الدخول</h2>
        <p>أدخل بيانات حسابك للوصول إلى المنصة</p>
      </div>
      
      <form id="signinForm">
        <div class="form-group">
          <label for="signinEmail">البريد الإلكتروني:</label>
          <input type="email" id="signinEmail" placeholder="example@gmail.com" required>
        </div>

        <div class="form-group">
          <label for="signinPassword">كلمة المرور:</label>
          <input type="password" id="signinPassword" placeholder="أدخل كلمة المرور" required>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
          <button type="submit" class="btn btn-success">🔑 تسجيل الدخول</button>
        </div>
      </form>
    </div>

    <!-- Sign Up Form -->
    <div id="signup-tab" class="auth-tab-content">
      <div class="section-header">
        <h2>إنشاء حساب جديد</h2>
        <p>انضم إلى منصة وجبتي وابدأ في تبادل الوجبات</p>
      </div>
      
      <form id="signupForm">
        <div class="form-group">
          <label for="signupUsername">اسم المستخدم:</label>
          <input type="text" id="signupUsername" placeholder="مثال: أحمد_محمد" required>
        </div>

        <div class="form-group">
          <label for="signupEmail">البريد الإلكتروني:</label>
          <input type="email" id="signupEmail" placeholder="example@gmail.com" required>
        </div>

        <div class="form-group">
          <label for="signupPassword">كلمة المرور:</label>
          <input type="password" id="signupPassword" placeholder="6 أحرف على الأقل" minlength="6" required>
        </div>

        <div class="form-group">
          <label for="confirmPassword">تأكيد كلمة المرور:</label>
          <input type="password" id="confirmPassword" placeholder="أعد إدخال كلمة المرور" required>
        </div>

        <div style="text-align: center; margin-top: 2rem;">
          <button type="submit" class="btn btn-success">✨ إنشاء الحساب</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Phone Setup Modal -->
  <div id="phoneSetupModal" class="verification-modal">
    <div class="verification-content">
      <h2 class="verification-header">📱 إضافة رقم الجوال</h2>
      <p class="verification-description">
        لتتمكن من بيع الوجبات، يرجى إضافة رقم جوالك للتواصل مع المشترين
      </p>
      
      <div class="verification-info">
        <strong>📞 لماذا نحتاج رقم الجوال؟</strong><br>
        • للتواصل مع المشترين عبر واتساب<br>
        • لإرسال تفاصيل الحجوزات<br>
        • لضمان التواصل السريع والآمن<br>
      </div>
      
      <input 
        type="tel" 
        id="phoneSetupInput" 
        class="phone-input"
        placeholder="05XXXXXXXX" 
        maxlength="10"
      />
      
      <div id="phoneSetupError" class="verification-error"></div>
      
      <button class="btn btn-success" id="savePhoneBtn" onclick="savePhoneNumber()">
        💾 حفظ رقم الجوال
      </button>
      
      <button class="btn btn-secondary" onclick="skipPhoneSetup()">
        ⏭️ تخطي الآن
      </button>
    </div>
  </div>

  <!-- Role Selection Section -->
  <div class="container hidden" id="roleSelection">
    <div class="user-info">
      <div class="welcome-message">
        <h3>مرحباً، <span id="usernameDisplay"></span>! 👋</h3>
        <p>اختر ما تريد القيام به اليوم</p>
        <div class="user-actions">
          <button class="btn btn-secondary btn-small" onclick="showProfile()">⚙️ الملف الشخصي</button>
          <button class="btn btn-danger btn-small" onclick="signOut()">🚪 تسجيل الخروج</button>
        </div>
      </div>
    </div>
    
    <div class="role-cards">
      <div class="role-card" onclick="showSeller()">
        <div class="role-icon">💰</div>
        <div class="role-title">أنا بائع</div>
        <div class="role-description">أريد بيع وجبتي الجامعية وإدارة طلبات الحجز بأمان</div>
      </div>
      
      <div class="role-card" onclick="showBuyer()">
        <div class="role-icon">🛒</div>
        <div class="role-title">أنا مشتري</div>
        <div class="role-description">أريد شراء وجبة من بائع موثوق ومقيم بأمان</div>
      </div>
    </div>
  </div>

  <!-- User Profile Modal -->
  <div id="profileModal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 1rem; color: #667eea;">الملف الشخصي</h3>
      
      <div class="profile-info">
        <div class="info-item">
          <strong>اسم المستخدم:</strong>
          <span id="profileUsername">-</span>
        </div>
        <div class="info-item">
          <strong>البريد الإلكتروني:</strong>
          <span id="profileEmail">-</span>
        </div>
        <div class="info-item">
          <strong>رقم الجوال:</strong>
          <span id="profilePhone">غير مضاف</span>
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn btn-contact" onclick="showAddPhoneModal()">📱 إضافة/تحديث الجوال</button>
        <button class="btn btn-secondary" onclick="closeProfileModal()">إغلاق</button>
      </div>
    </div>
  </div>

  <!-- Seller Section -->
  <div class="container hidden" id="sellerSection">
    <!-- Dashboard Tabs -->
    <div class="dashboard-tabs">
      <button class="tab-btn active" onclick="showTab(event, 'add-meal')">➕ إضافة وجبة</button>
      <button class="tab-btn" onclick="showTab(event, 'manage-orders')">📋 إدارة الطلبات</button>
      <button class="tab-btn" onclick="showTab(event, 'my-meals')">🍽️ وجباتي</button>
      <button class="tab-btn" onclick="showTab(event, 'notifications')">🔔 الإشعارات</button>
    </div>

    <!-- Add Meal Tab -->
    <div id="add-meal-tab" class="tab-content">
      <div class="section-header">
        <h2>نشر عرض وجبة جديد</h2>
        <p>أضف تفاصيل وجبتك واحصل على تقييمات من المشترين</p>
      </div>
      
      <form id="offerForm">
        <div class="form-group">
          <label for="mealType">نوع الوجبة:</label>
          <select id="mealType">
            <option value="فطور">🌅 فطور</option>
            <option value="غداء">☀️ غداء</option>
            <option value="عشاء">🌙 عشاء</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="mealPrice">السعر المطلوب (ريال):</label>
          <input type="number" id="mealPrice" placeholder="مثال: 3" min="0.5" step="0.5" required>
        </div>
        
        <div class="form-group">
          <label for="mealDetails">تفاصيل الوجبة:</label>
          <textarea id="mealDetails" placeholder="مثال: وجبة فطور يوم الاحد 9 يوليو ..." rows="3" style="resize: vertical;"></textarea>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
          <button type="submit" class="btn btn-success">✨ نشر العرض</button>
        </div>
      </form>
    </div>

    <!-- Manage Orders Tab -->
    <div id="manage-orders-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>إدارة طلبات الحجز</h2>
        <p>راجع واعتمد أو ارفض طلبات حجز وجباتك</p>
      </div>
      
      <div id="reservationsList">
        <div class="empty-state">
          <div class="empty-state-icon">📭</div>
          <h3>لا توجد طلبات حجز</h3>
          <p>ستظهر هنا طلبات الحجز الجديدة لوجباتك</p>
        </div>
      </div>
    </div>

    <!-- My Meals Tab -->
    <div id="my-meals-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>وجباتي المنشورة</h2>
        <p>تصفح جميع الوجبات التي نشرتها وحالتها</p>
      </div>
      
      <div id="sellerOffers">
        <div class="empty-state">
          <div class="empty-state-icon">🍽️</div>
          <h3>لم تنشر أي وجبات بعد</h3>
          <p>ابدأ بإضافة وجبة من تبويب "إضافة وجبة"</p>
        </div>
      </div>
    </div>

    <!-- Notifications Tab -->
    <div id="notifications-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>الإشعارات</h2>
        <p>تابع آخر التحديثات وطلبات الحجز</p>
      </div>
      
      <div id="notificationsList">
        <div class="empty-state">
          <div class="empty-state-icon">🔔</div>
          <h3>لا توجد إشعارات</h3>
          <p>ستظهر هنا الإشعارات الجديدة</p>
        </div>
      </div>
    </div>

    <div style="text-align: center; margin-top: 2rem;">
      <button class="btn btn-secondary" onclick="goHome()">🏠 رجوع للرئيسية</button>
    </div>
  </div>

  <!-- Buyer Section -->
  <div class="container hidden" id="buyerSection">
    <div class="section-header">
      <h2>الوجبات المتاحة للشراء</h2>
      <p>تصفح العروض المتاحة من البائعين الموثوقين</p>
    </div>
    
    <div id="offersList"></div>
    
    <div style="text-align: center; margin-top: 2rem;">
      <button class="btn btn-secondary" onclick="goHome()">🏠 رجوع للرئيسية</button>
    </div>
  </div>

  <!-- Rating Modal -->
  <div id="ratingModal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 1rem; color: #667eea;">قيم تجربتك مع البائع</h3>
      <p style="margin-bottom: 1.5rem; color: #718096;">ساعد الآخرين باختيار البائع المناسب</p>
      <div class="rating-stars" id="ratingStars">
        <span data-rating="1">⭐</span>
        <span data-rating="2">⭐</span>
        <span data-rating="3">⭐</span>
        <span data-rating="4">⭐</span>
        <span data-rating="5">⭐</span>
      </div>
      <p style="margin-bottom: 2rem; font-size: 1.1rem; font-weight: 600;" id="ratingText">اختر التقييم</p>
      <div class="action-buttons">
        <button class="btn btn-success" onclick="submitRating()">تأكيد التقييم</button>
        <button class="btn btn-secondary" onclick="closeRatingModal()">إلغاء</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
    <p>جاري التحميل...</p>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-icon">⚠️</div>
      <div class="footer-text">
        <p>هذه المنصة غير رسمية، صُممت باجتهاد طلاب الجامعة</p>
        <p>هدفها الحد من هدر الوجبات فقط، تأكد من تفاصيل الحجز قبل الدفع أو الاستلام.</p>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>