<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>بيع وشراء وجبات - مع التحقق الآمن</title>
  <link rel="stylesheet" href="style.css">
  
  <!-- Socket.IO -->
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" onclick="toggleTheme()" title="تبديل الوضع">
    <span id="themeIcon">🌙</span>
  </button>

  <header>
    <h1>🍽️ منصة وجبتي</h1>
    <p>منصة آمنة ومتطورة لتبادل وجبات المطعم مع نظام التقييم والتحقق المتقدم</p>
  </header>

  <!-- Role Selection Section -->
  <div class="container" id="roleSelection">
    <div class="section-header">
      <h2>مرحباً بك في منصة تبادل الوجبات المتطورة</h2>
      <p>اختر دورك للبدء في استخدام المنصة الجديدة والمحسنة مع نظام الحماية المتقدم</p>
    </div>
    
    <div class="role-cards">
      <div class="role-card" onclick="showSeller()">
        <div class="role-icon">💰</div>
        <div class="role-title">أنا بائع</div>
        <div class="role-description">أريد بيع وجبتي الجامعية وإدارة طلبات الحجز بأمان</div>
      </div>
      
      <div class="role-card" onclick="showBuyer()">
        <div class="role-icon">🛒</div>
        <div class="role-title">أنا مشتري</div>
        <div class="role-description">أريد شراء وجبة من بائع موثوق ومقيم بأمان</div>
      </div>
    </div>
  </div>

  <!-- Seller Section -->
  <div class="container hidden" id="sellerSection">
    <!-- Dashboard Tabs -->
    <div class="dashboard-tabs">
      <button class="tab-btn active" onclick="showTab(event, 'add-meal')">➕ إضافة وجبة</button>
      <button class="tab-btn" onclick="showTab(event, 'manage-orders')">📋 إدارة الطلبات</button>
      <button class="tab-btn" onclick="showTab(event, 'my-meals')">🍽️ وجباتي</button>
      <button class="tab-btn" onclick="showTab(event, 'notifications')">🔔 الإشعارات</button>
    </div>

    <!-- Add Meal Tab -->
    <div id="add-meal-tab" class="tab-content">
      <div class="section-header">
        <h2>نشر عرض وجبة جديد</h2>
        <p>أضف تفاصيل وجبتك واحصل على تقييمات من المشترين</p>
      </div>
      
      <form id="offerForm">
        <div class="form-group">
          <label for="sellerName">اسم البائع:</label>
          <input type="text" id="sellerName" placeholder="مثال: أحمد محمد" required>
        </div>

        <div class="form-group">
          <label for="mealType">نوع الوجبة:</label>
          <select id="mealType">
            <option value="فطور">🌅 فطور</option>
            <option value="غداء">☀️ غداء</option>
            <option value="عشاء">🌙 عشاء</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="mealPrice">السعر المطلوب (ريال):</label>
          <input type="number" id="mealPrice" placeholder="مثال: 3" min="0.5" step="0.5" required>
        </div>
        
        <div class="form-group">
          <label for="mealDetails">تفاصيل الوجبة:</label>
          <textarea id="mealDetails" placeholder="مثال: وجبة فطور يوم الاحد 9 يوليو ..." rows="3" style="resize: vertical;"></textarea>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
          <button type="submit" class="btn btn-success">✨ نشر العرض</button>
        </div>
      </form>
    </div>

    <!-- Manage Orders Tab -->
    <div id="manage-orders-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>إدارة طلبات الحجز</h2>
        <p>راجع واعتمد أو ارفض طلبات حجز وجباتك</p>
      </div>
      
      <div id="reservationsList">
        <div class="empty-state">
          <div class="empty-state-icon">📭</div>
          <h3>لا توجد طلبات حجز</h3>
          <p>ستظهر هنا طلبات الحجز الجديدة لوجباتك</p>
        </div>
      </div>
    </div>

    <!-- My Meals Tab -->
    <div id="my-meals-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>وجباتي المنشورة</h2>
        <p>تصفح جميع الوجبات التي نشرتها وحالتها</p>
      </div>
      
      <div id="sellerOffers">
        <div class="empty-state">
          <div class="empty-state-icon">🍽️</div>
          <h3>لم تنشر أي وجبات بعد</h3>
          <p>ابدأ بإضافة وجبة من تبويب "إضافة وجبة"</p>
        </div>
      </div>
    </div>

    <!-- Notifications Tab -->
    <div id="notifications-tab" class="tab-content hidden">
      <div class="section-header">
        <h2>الإشعارات</h2>
        <p>تابع آخر التحديثات وطلبات الحجز</p>
      </div>
      
      <div id="notificationsList">
        <div class="empty-state">
          <div class="empty-state-icon">🔔</div>
          <h3>لا توجد إشعارات</h3>
          <p>ستظهر هنا الإشعارات الجديدة</p>
        </div>
      </div>
    </div>

    <div style="text-align: center; margin-top: 2rem;">
      <button class="btn btn-secondary" onclick="goHome()">🏠 رجوع للرئيسية</button>
    </div>
  </div>

  <!-- Buyer Section -->
  <div class="container hidden" id="buyerSection">
    <div class="section-header">
      <h2>الوجبات المتاحة للشراء</h2>
      <p>تصفح العروض المتاحة من البائعين الموثوقين</p>
    </div>
    
    <div id="offersList"></div>
    
    <div style="text-align: center; margin-top: 2rem;">
      <button class="btn btn-secondary" onclick="goHome()">🏠 رجوع للرئيسية</button>
    </div>
  </div>

  <!-- Phone Verification Modal -->
  <div id="phoneVerificationModal" class="verification-modal">
    <div class="verification-content">
      <!-- خطوة 1: إدخال رقم الجوال -->
      <div class="verification-step active" id="verifyStep1">
        <h2 class="verification-header">🔐 التحقق الآمن من الجوال</h2>
        <p class="verification-description">
          لضمان الأمان وحماية بياناتك، يرجى التحقق من رقم جوالك أولاً
        </p>
        
        <div class="verification-info">
          <strong>📱 لماذا نحتاج التحقق؟</strong><br>
          • حماية حسابك من الاستخدام غير المصرح<br>
          • ضمان وصول الإشعارات المهمة إليك<br>
          • تأمين معاملاتك المالية<br>
        </div>
        
        <input 
          type="tel" 
          id="verifyPhoneInput" 
          class="phone-input"
          placeholder="05XXXXXXXX" 
          maxlength="10"
        />
        
        <div id="verifyError1" class="verification-error"></div>
        
        <button class="btn btn-success" id="sendVerifyCodeBtn" onclick="sendVerificationCode()">
          📱 إرسال كود التحقق
        </button>
        
        <button class="btn btn-secondary" onclick="closeVerificationModal()">
          ❌ إلغاء
        </button>
      </div>
      
      <!-- خطوة 2: إدخال الكود -->
      <div class="verification-step" id="verifyStep2">
        <h2 class="verification-header">🔍 إدخال كود التحقق</h2>
        <p class="verification-description">
          تم إرسال كود التحقق المكون من 6 أرقام إلى:
        </p>
        
        <div class="phone-display" id="verifiedPhoneDisplay">
          +966XXXXXXXXX
        </div>
        
        <input 
          type="text" 
          id="verifyCodeInput" 
          class="code-input"
          placeholder="● ● ● ● ● ●" 
          maxlength="6"
        />
        
        <div id="verifyError2" class="verification-error"></div>
        
        <button class="btn btn-success" id="confirmVerifyCodeBtn" onclick="verifyCode()">
          ✅ تحقق من الكود
        </button>
        
        <div id="resendCountdown" class="countdown-timer"></div>
        
        <button class="btn btn-warning" id="resendCodeBtn" onclick="resendCode()" disabled>
          🔄 إرسال الكود مرة أخرى
        </button>
        
        <button class="btn btn-secondary" onclick="goToVerifyStep1()">
          🔙 تغيير رقم الجوال
        </button>
      </div>
      
      <!-- خطوة 3: نجح التحقق -->
      <div class="verification-step" id="verifyStep3">
        <div class="verification-success">
          <div class="success-icon">✅</div>
          <h2 class="verification-header" style="color: #48bb78;">
            تم التحقق بنجاح! 🎉
          </h2>
          <p class="verification-description" style="color: #48bb78;">
            تم التحقق من رقم جوالك بنجاح وتم حفظه بأمان.<br>
            يمكنك الآن الوصول إلى جميع الميزات المتقدمة في المنصة.
          </p>
          
          <div class="verification-info" style="border-right-color: #48bb78;">
            <strong>🛡️ تم تأمين حسابك بنجاح</strong><br>
            • رقم جوالك محمي ومشفر<br>
            • ستحصل على إشعارات مهمة<br>
            • يمكنك الآن إدارة طلباتك بأمان<br>
          </div>
          
          <button class="btn btn-success" onclick="proceedAfterVerification()">
            🚀 متابعة إلى المنصة
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Rating Modal -->
  <div id="ratingModal" class="modal">
    <div class="modal-content">
      <h3 style="margin-bottom: 1rem; color: #667eea;">قيم تجربتك مع البائع</h3>
      <p style="margin-bottom: 1.5rem; color: #718096;">ساعد الآخرين باختيار البائع المناسب</p>
      <div class="rating-stars" id="ratingStars">
        <span data-rating="1">⭐</span>
        <span data-rating="2">⭐</span>
        <span data-rating="3">⭐</span>
        <span data-rating="4">⭐</span>
        <span data-rating="5">⭐</span>
      </div>
      <p style="margin-bottom: 2rem; font-size: 1.1rem; font-weight: 600;" id="ratingText">اختر التقييم</p>
      <div class="action-buttons">
        <button class="btn btn-success" onclick="submitRating()">تأكيد التقييم</button>
        <button class="btn btn-secondary" onclick="closeRatingModal()">إلغاء</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-spinner"></div>
    <p>جاري التحميل...</p>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-icon">⚠️</div>
      <div class="footer-text">
        <p>هذه المنصة غير رسمية، صُممت باجتهاد طلاب الجامعة</p>
        <p>هدفها الحد من هدر الوجبات فقط، تأكد من تفاصيل الحجز قبل الدفع أو الاستلام.</p>
      </div>
    </div>
  </footer>

  <script src="script.js"></script>
</body>
</html>